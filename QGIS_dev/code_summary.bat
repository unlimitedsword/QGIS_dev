@ECHO OFF
SETLOCAL ENABLEDELAYEDEXPANSION

:: =================================================================
:: 配置区域
:: =================================================================
:: 设置最终生成的 txt 文件名
SET "OUTPUT_FILE=code_summary.txt"


:: =================================================================
:: 脚本主区域
:: =================================================================

:: 切换当前目录到本 bat 文件所在的目录
CD /D "%~dp0"

:: 切换命令行代码页为 UTF-8 (65001)，以正确读取和处理 UTF-8 编码的源文件
CHCP 65001 > NUL

:: 先创建或清空输出文件。这能保证即使没有找到任何 cpp/h 文件，
:: 也会有一个空的 txt 文件生成，避免“文件未生成”的困惑。
TYPE NUL > "%OUTPUT_FILE%"

ECHO 正在生成代码摘要，请稍候...
ECHO.

:: 设置一个标记，用于判断是否找到了文件
SET "found_files=0"

:: 遍历当前目录下所有的 .cpp 和 .h 文件
FOR %%F IN (*.cpp *.h) DO (
    
    :: 在命令行窗口中显示进度
    ECHO 正在处理文件: %%F
    
    :: 将这部分内容的输出追加到文件中
    (
        :: 【关键修复】使用 ^ 对括号进行转义，避免语法错误
        ECHO ^(%%F^)
        TYPE "%%F"
        ECHO.
    )>>"%OUTPUT_FILE%"
    
    :: 标记为已找到文件
    SET "found_files=1"
)

ECHO.
ECHO ================================================
IF !found_files! == 1 (
    ECHO 操作完成！
    ECHO 所有 .cpp 和 .h 文件的内容已汇总到 "%OUTPUT_FILE%" 文件中。
) ELSE (
    ECHO 未在当前目录下找到任何 .cpp 或 .h 文件。
    ECHO 已生成一个空的 "%OUTPUT_FILE%"。
)
ECHO ================================================
ECHO.

:: 暂停程序，以便用户可以看到完成信息
PAUSE
ENDLOCAL